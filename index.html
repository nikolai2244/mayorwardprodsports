<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MayorWard ProdSports – Live NFL Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Tech Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

<style>

/* ============================== */
/*         GLOBAL THEME          */
/* ============================== */

:root {
  --bg-dark: #0a0a0a;
  --bg-card: #121212;
  --bg-elevated: #1a1a1a;
  --accent: #FF0033;
  --accent-glow: rgba(255,0,51,0.5);
  --tech-cyan: #00Eaff;
  --text-light: #e5e5e5;
  --text-dim: #999;
}

body {
  margin: 0;
  background: var(--bg-dark);
  color: var(--text-light);
  font-family: 'Roboto', sans-serif;
}

/* ============================== */
/*           HEADER               */
/* ============================== */

header {
  padding: 25px 0;
  text-align: center;
  background: linear-gradient(180deg, #111, #000);
  border-bottom: 2px solid var(--accent);
  font-family: 'Orbitron', sans-serif;
  font-size: 2.2rem;
  letter-spacing: 2px;
  color: var(--accent);
  text-shadow: 0 0 15px var(--accent-glow);
}

/* ============================== */
/*           LAYOUT               */
/* ============================== */

.container {
  max-width: 1400px;
  margin: auto;
  padding: 20px;
}

.section {
  margin-bottom: 40px;
}

.section-title {
  font-size: 1.6rem;
  font-family: 'Orbitron', sans-serif;
  margin-bottom: 15px;
  color: var(--tech-cyan);
  border-left: 4px solid var(--accent);
  padding-left: 10px;
}

/* ============================== */
/*             CARDS              */
/* ============================== */

.card-grid {
  display: grid;
  gap: 20px;
  grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
}

.card {
  background: var(--bg-card);
  border: 1px solid #222;
  padding: 20px;
  border-radius: 14px;
  transition: .25s;
}

.card:hover {
  transform: translateY(-6px);
  box-shadow: 0 0 20px var(--accent-glow);
}

.team-title {
  font-weight: 700;
  font-size: 1.3rem;
  margin-bottom: 6px;
}

.score, .odds, .weather {
  margin-top: 6px;
  font-size: 1rem;
}

.status {
  margin-top: 8px;
  font-style: italic;
  color: var(--text-dim);
}

/* ============================== */
/*         STATUS LABELS          */
/* ============================== */

.status-line {
  font-size: 0.9rem;
  margin-bottom: 5px;
  color: var(--text-dim);
}

.timestamp {
  font-size: 0.8rem;
  color: var(--text-dim);
}

/* ============================== */
/*       REFRESH INDICATOR        */
/* ============================== */

.refresh-note {
  text-align: center;
  font-size: 0.85rem;
  color: var(--text-dim);
  margin-top: 20px;
  font-style: italic;
}

</style>
</head>
<body>

<header>MAYORWARD PRODSPRTS</header>

<div class="container">

  <!-- LIVE SCORES -->
  <div class="section">
    <div class="section-title">LIVE NFL SCORES</div>
    <div id="scoresStatus" class="status-line">Loading scores…</div>
    <div id="scoresTimestamp" class="timestamp"></div>
    <div id="scoresContainer" class="card-grid"></div>
  </div>

  <!-- LIVE ODDS -->
  <div class="section">
    <div class="section-title">LIVE ODDS</div>
    <div id="oddsStatus" class="status-line">Loading odds…</div>
    <div id="oddsTimestamp" class="timestamp"></div>
    <div id="oddsContainer" class="card-grid"></div>
  </div>

  <!-- WEATHER (Optional) -->
  <div class="section">
    <div class="section-title">WEATHER SNAPSHOT</div>
    <div id="weatherStatus" class="status-line">Waiting for weather…</div>
    <div id="weatherContainer" class="card-grid"></div>
  </div>

  <div class="refresh-note">Auto-refresh interval: every 1 hour</div>

</div>

<!-- ============================== -->
<!--      MAIN JAVASCRIPT          -->
<!-- ============================== -->

<script>

/* ========================================================= */
/*                    FETCH: LIVE SCORES                     */
/* ========================================================= */

async function fetchScores() {
  const statusEl = document.getElementById("scoresStatus");
  const container = document.getElementById("scoresContainer");
  const timestampEl = document.getElementById("scoresTimestamp");

  try {
    statusEl.textContent = "Loading scores…";

    const res = await fetch("/api/espn-games");
    const data = await res.json();

    if (data.error) {
      statusEl.textContent = "Error fetching scores.";
      return;
    }

    container.innerHTML = "";

    data.games.forEach(game => {
      const comp = game.competitions?.[0];
      if (!comp) return;

      const home = comp.competitors.find(c => c.homeAway === "home");
      const away = comp.competitors.find(c => c.homeAway === "away");

      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <div class="team-title">${away.team.displayName} @ ${home.team.displayName}</div>
        <div class="score"><strong>Score:</strong> ${away.score} - ${home.score}</div>
        <div class="status">${game.status.type.shortDetail}</div>
      `;
      container.appendChild(div);
    });

    statusEl.textContent = "";
    timestampEl.textContent = "Updated: " + new Date().toLocaleString();

  } catch (err) {
    statusEl.textContent = "Error connecting to scores.";
  }
}

/* ========================================================= */
/*                    FETCH: LIVE ODDS                       */
/* ========================================================= */

async function fetchOdds() {
  const statusEl = document.getElementById("oddsStatus");
  const container = document.getElementById("oddsContainer");
  const timestampEl = document.getElementById("oddsTimestamp");

  try {
    statusEl.textContent = "Loading odds…";

    const res = await fetch("/api/odds");
    const data = await res.json();

    if (data.error) {
      statusEl.textContent = "Error loading odds.";
      return;
    }

    container.innerHTML = "";

    data.games.forEach(game => {
      const bookmaker = game.bookmakers?.[0];
      const markets = bookmaker?.markets || [];
      
      let formatted = markets
        .map(m => m.outcomes.map(o => `${o.name}: ${o.price}`).join(" | "))
        .join("<br>");

      if (!formatted) formatted = "Odds unavailable";

      const div = document.createElement("div");
      div.className = "card";

      div.innerHTML = `
        <div class="team-title">${game.away_team} @ ${game.home_team}</div>
        <div class="odds"><strong>Odds:</strong><br>${formatted}</div>
      `;

      container.appendChild(div);
    });

    statusEl.textContent = "";
    timestampEl.textContent = "Updated: " + new Date().toLocaleString();

  } catch (err) {
    statusEl.textContent = "Error connecting to odds.";
  }
}

/* ========================================================= */
/*                     FETCH: WEATHER                        */
/* ========================================================= */

async function fetchWeather() {
  const statusEl = document.getElementById("weatherStatus");
  const container = document.getElementById("weatherContainer");

  try {
    statusEl.textContent = "Loading weather…";

    // Detroit example (you can change to dynamic later)
    const res = await fetch("/api/weather?lat=42.3314&lon=-83.0458");
    const data = await res.json();

    container.innerHTML = "";

    if (!data.weather) {
      statusEl.textContent = "Weather unavailable";
      return;
    }

    const w = data.weather.current;

    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <div class="team-title">Detroit</div>
      <div class="weather"><strong>Temp:</strong> ${w.temperature_2m}°C</div>
      <div class="weather"><strong>Wind:</strong> ${w.wind_speed_10m} m/s</div>
      <div class="weather"><strong>Precip:</strong> ${w.precipitation} mm</div>
    `;
    container.appendChild(div);

    statusEl.textContent = "";

  } catch (err) {
    statusEl.textContent = "Weather service error";
  }
}

/* ========================================================= */
/*                    AUTO REFRESH CONTROL                   */
/* ========================================================= */

fetchScores();
fetchOdds();
fetchWeather();

// Refresh every **1 hour**
setInterval(fetchScores, 3600000);
setInterval(fetchOdds, 3600000);
setInterval(fetchWeather, 3600000);

</script>

</body>
</html>
